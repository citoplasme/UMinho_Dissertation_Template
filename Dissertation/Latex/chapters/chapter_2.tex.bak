\chapter{State of the Art}
\label{chap:chap2}
The present section provides insight on the developed work and achieved progress throughout the years in the medical imaging field of ischemic stroke lesion segmentation, as well as the prediction of the final infarct volume. For each task, the most relevant works are addressed and discussed, along with their advantages and shortcomings.

Being a relatively recent research area, the amount of proposed methods is short. The most common stroke lesion segmentation strategies rely on classification methods such as Decision Trees and variants of the same \cite{chyzhyk2015active, maier2015extra, robben2015voxel, mckinley2015segmenting}. Nevertheless, Bayes classification has been applied as well \cite{griffis2016voxel}. 

As of lately, lesion outcome prediction has been the new focus in the ischemic stroke context. While segmenting the stroke lesions lets the clinician evaluate the state of the infarcted region at a certain instant in time, the prediction of the final infarct area allows the assessment of the evolution of the lesion. This assessment is crucial in order to confirm which reperfusion therapy should be applied to the patient. The first developed prediction strategies comprised the use of parametric normal methods \cite{rose2001mri}. More recently, Convolutional Neural Networks (\acrshort{cnn}s) have been gaining interest \cite{nielsen2018prediction}, with Fully Convolutional Neural Networks (\acrshort{fcnn}s) \cite{pinto2018stroke, pinto} and ensembles of this kind of networks being the most resorted strategies \cite{choi2016ensemble, winzeck2018isles}.
%prediction approaches resort to regression models \cite{scalzo2012regional}

The first proposed approaches for delineation of the lesions resorted to anatomical \acrshort{mri} scans, such as T1- and T2-weighted sequences, \acrshort{flair}, and occasionally the source functional \acrshort{mri} (\acrshort{fmri}) and \acrshort{adc} maps \cite{chyzhyk2015active, maier2015extra, griffis2016voxel}. Only in the past four years, did the researchers begin to include perfusion maps such as \acrshort{rcbf}, \acrshort{rcbv}, \acrshort{ttp}, \acrshort{mtt} and \acrshort{tmax}, along with \acrshort{adc} \cite{robben2015voxel, mckinley2015segmenting, choi2016ensemble, mckinley2017fully, winzeck2018isles, pinto2018stroke, nielsen2018prediction}, although \citet{rose2001mri} were the pioneers in applying standard parametric maps to predict the final infarct volume. Moreover, not long ago were developed strategies where, besides processing the standard perfusion and diffusion maps, the data-driven \acrshort{4d} \acrshort{pwi} were also included \cite{pinto}. %Nevertheless, some authors still resort to \acrshort{ct} scans instead of multi-modal \acrshort{mri} \cite{rajini2013computer, robben2018prediction}.

\section{Lesion Segmentation Methods}
Classification of the stroke lesions through Decision Trees has been the go-to strategy in ischemic stroke lesion segmentation, encompassing Random Forests \cite{chyzhyk2015active}, Extra Trees \cite{maier2015extra}, cascaded Extremely Randomized Trees \cite{robben2015voxel} and Segmentation Forests \cite{mckinley2015segmenting}. 

\citet{chyzhyk2015active} developed a classification based approach based on Random Forests for multi-modal automated stroke lesion segmentation. The classifier was trained by an Active Learning selective sampling strategy with T1-weighted \acrshort{mri}, T2, \acrshort{flair}, \acrshort{fmri} and \acrshort{dwi} data as its input, and was then applied to each voxel of the image to predict the corresponding class. The Active Learning selective sampling creates unsupervised measures, corresponding to the uncertainty associated to each data point, which are mapped after an active exploration of the data domain. Their work was innovative regarding the introduction of diffusion, anatomical and functional \acrshort{mri} data to segment stroke lesions. However, their approach lacked the capability to delineate scattered lesions. 

\citet{maier2015extra} stated that Decision Trees consist of a simple approach with little data preparation required, and are fast in training and application, they are very prone to overfitting and present high variance in terms of their bias. To address these disadvantages, \citet{maier2015extra} proposed a fully automated approach for lesion segmentation based on \acrshort{flair}, T1- and T2-weighted, \acrshort{adc} and \acrshort{dwi} data. To that extent, they resorted to Extra Tree forests, or Extremely Randomised Trees, to classify the voxels as lesion or healthy tissue. These forests consist of ensembles of tree classifiers based on weak learners with the aim of enhancing the predictive performance by adding more randomness to the Decision Trees. Extra Trees resort to a reduced search space by randomly attributing a threshold value to each node, which makes the training faster. Although being capable of reaching good performances with this strategy on the chosen dataset, the authors observed that its capability of segmenting accurately depended on high image quality.

\citet{robben2015voxel} developed a supervised method based on a cascade of Extra Trees which was evaluated on the \acrshort{miccai} \acrshort{isles} challenge on two multi-modal \acrshort{mri} datasets for Subacute Ischemic Stroke Lesion Segmentation (\acrshort{siss}) and for Acute Stroke Outcome and Penumbra Estimation (\acrshort{spes}), which is also a segmentation challenge. While the \acrshort{siss} dataset comprised T1- and T2-weighted images, \acrshort{flair} and \acrshort{dwi} data, the \acrshort{spes} set was composed by the standard diffusion and perfusion maps referred in the previous section, excluding \acrshort{ttp}. After extracting features on different spatial scales, the cascaded classifier was first trained voxel-wise on a dataset that contained manually delineated lesions. This cascaded Extra Trees classifier comprised three steps. First, a voxel was given to the classifier. Resorting to a few amount of features, if the classifier decided with high probability that the voxel corresponded to healthy tissue, then that value was saved for the given voxel. Otherwise, it proceeded to a second classifier that resorted to a larger set of features and it repeated the process explained before. If the voxel was classified as lesion then the third classifier, using the same features as the latter one, computed its probability of being a lesion, aided by the earlier computed probabilities of that voxel, as well as its neighboring ones. When applied to the test data, it generated lesion probabilities maps, which were then thresholded to generate the final segmentation with an optimal Dice score. Although the proposal was capable of achieving competitive performances on both datasets, the inter-subject variability was proven to be quite large in the \acrshort {siss} dataset.

\citet{mckinley2015segmenting} also proposed a method using Random Forests as a classifier, which was evaluated on the \acrshort{spes} dataset. These authors proposed a variant of the Random Forests algorithm for the segmentation task, which they called Segmentation Forests. Through their proposal, they claimed that they were capable of avoiding the correlation of the medical imaging data at the patient level, as well as the problem of unbalanced classes. To that extent, the training data was bootstrapped at the patient level and used the resultant out-of-sample patients to empirically reach a threshold value at which the Dice score was maximized. Through these Segmentation Forests, the authors claimed to be capable of decorrelating the trees to reduce the variance of the model and achieving a robustness to different levels of data imbalance. This new algorithm outperformed Random Forests, achieving the best performance in the 2015 \acrshort{spes} competition.

Other classifying approaches may be found, such as the one proposed by \citet{griffis2016voxel}. Here, the authors developed a fully automated and supervised voxel-based Gaussian Na√Øve Bayes classification using only T1-weighted images to delineate stroke lesions. To this extent, feature maps were created to provide data corresponding to the lesion core and abnormal tissue. Prior to their generation, they modeled these two classes voxels, independently, aiming to avoid including redundant information. Then, training and validation were performed based on a leave-one-case-out cross-validation strategy. For each case, the classifier was trained on 29 out of 30 cases and was then applied to the untrained case. Note that the dataset used in this strategy is different from those of \acrshort{siss} and \acrshort{spes} competitions. This approach allowed them to obtain inferences regarding the generalizability of their methods. Being able to obtain favorable performances, while needing only to resort to one \acrshort{mri} modality was one of their work's contributions. However, their approach failed to detect correctly some small lesions depending on their location. Furthermore, this classification method assumed that each case had an affected and an unaffected brain hemisphere, which makes it dependent on laterality to predict whether a voxel is a part of the lesion or not. Due to this, if some case violated this assumption, the segmentation process would not be as accurate.

\section{Lesion Prediction Approaches}
Recently proposed strategies are more directed to predict the evolution of the stroke lesion at a certain point in time. Classifying methods, such as parametric normal methods, were first implemented to predict the outcome \cite{rose2001mri}. Nowadays, most authors resort to deep learning-based approaches, with \acrshort{cnn}s achieving great success in medical image analysis. In fact, network structures such as the U-Net have been considered to be extremely adequate for this type of problems \cite{unet}. Lately, it has been shown that the ensemble strategy is capable of enhancing the performance of the network when compared to shallow structures. As a matter of fact, ensemble approaches have won competitions such as \acrshort{isles} 2016 and 2017 Challenges \cite{choi2016ensemble, winzeck2018isles}. Additionally, a variant of Segmentation Forests dedicated to the prediction task has also been implemented recently \cite{mckinley2017fully}.

\citet{rose2001mri} developed a prediction method based on parametric normal classifiers. The first stage of this method comprised the definition of a region of interest (\acrshort{roi}), based on the \acrshort{mtt} sequence. From this \acrshort{roi} were derived other diffusion and perfusion measures, such as \acrshort{rcbf}, \acrshort{rcbv} and \acrshort{dwi}. Due to this, they avoided including non-brain tissue from sulcal or ventricular regions. Then, the prediction of the lesion evolution was performed through Gaussian mixture models trained with different subsets of diffusion and perfusion maps. Nevertheless, their method was only tested on a small dataset. Therefore, the accuracy of the prediction model was not completely validated.

More recently, \citet{mckinley2017fully} proposed a strategy with two voxel-wise predictive models based on their Segmentation Forests algorithm \cite{mckinley2015segmenting}. One of them predicted the patient outcome, after the therapy produced a good response, whereas the other predicted the natural course of stroke. Although the prediction was performed voxel-wise, they resorted to features retrieved from the surrounding tissue. Their approach comprised two stages. First, two segmentation classifiers attempted to reproduce the manual delineation of the lesion in order to locate it. Then, two other predictive classifiers predicted the tissue that would infarct, by predicting the lesion extent, in case there was no reperfusion and if full reperfusion occurred, respectively. Through this approach they were able to attain an improved precision on the chosen dataset, but obtained an overestimation of the tissue damage in some patients.

\citet{choi2016ensemble} proposed an ensemble of two types of \acrshort{cnn}s, which won the \acrshort{isles} 2016 Challenge competition, where the first one comprised a \acrshort{3d} multi-scale residual U-Net and the second one consisted of a \acrshort{fcnn}. This \acrshort{fcnn} comprised two different pathways, each trained with a different dataset, but both composed by \acrshort{3d} convolutions, \acrshort{3d} max-pooling and fully connected layers. To that extent, the authors considered the lesion prediction in the former network as a voxel-wise segmentation problem, whereas in the \acrshort{fcnn} it was interpreted as a patch-wise classification problem, i.e., its aim was to predict if the patch contained a lesion or not. \citet{choi2016ensemble} approach resorted to the standard perfusion and diffusion maps. Additionally, clinical data such as \acrshort{tici}, Time to Treatment (\acrshort{ttt}), and Time Since Stroke (\acrshort{tss}) were included in the \acrshort{fcnn} model. To mitigate the class imbalance issue, they resorted to a multi-phase training, where in each phase the input data differed, while maintaining the network architecture. The ensemble comprised a total of 12 models -- 8 \acrshort{fcnn}s with different patch sizes, and 4 U-Net models where they varied the patch width, number of patches per case, and number of filters in the first convolutional layer. Through this approach, they were able to show that, although both networks have their weaknesses individually, when ensembled they complement each other and are capable of enhancing the prediction accuracy and robustness.

In the \acrshort{isles} 2017 Challenge competition, ensemble strategies were also proposed \cite{winzeck2018isles}. For instance, Mok et al. developed a strategy where they trained two U-Net models with adversarial training and ensembled them, in order to deal with the fact that the small lesion area and low amount of data might lead to overfitting. With this approach they achieved the top Dice score among all competitors. Additionally, Choi et al. proposed an ensemble approach of \acrshort{3d} models, comprising a multi-scale U-Net, a multi-scale \acrshort{fcnn} and a pyramid scene parsing network. Here, they resorted to the same implementation details used in their prior work \cite{choi2016ensemble}. Through this, they were able to reduce the model complexity without losing performance and simplified the training process by using probability calibration in the multi-phase training. 

\citet{nielsen2018prediction} compared three different \acrshort{cnn}s to predict the lesion outcome. One of them consisted of a \acrshort{cnn} based on the \acrshort{tmax} imaging biomarker (\acrshort{cnn}\textsubscript{Tmax}) to retrieve spatial information from this map and also to learn to detect false positive areas. The employment of \acrshort{cnn}\textsubscript{Tmax} aimed to assess whether \acrshort{tmax} comprised sufficient data to produce accurate predictions, if tissue predictions were restricted to a single population-wide threshold and if spatial information was included. The second one comprised a shallow \acrshort{cnn} (\acrshort{cnn}\textsubscript{shallow}) that took 9 \acrshort{mri} biomarkers. The last \acrshort{cnn} was a modified version of a SegNet \cite{segnet} (\acrshort{cnn}\textsubscript{deep}), resorting to 9 \acrshort{mri} biomarkers as well, to take advantage of their complex interplay and their task in stroke development. In order to justify whether the high performance achieved through \acrshort{cnn}\textsubscript{deep} was due to the addition of spatial information, they implemented the \acrshort{cnn}\textsubscript{shallow} which took the same input but contained fewer layers. Acute \acrshort{dwi} and \acrshort{pwi}, T2-weighted \acrshort{flair} and follow-up T2-weighted \acrshort{flair} were fed to the networks. Interestingly, their proposal predicted the final infarct volume on a 30-day follow-up acquisition, and, therefore, involved fewer changes regarding the salvageable tissue and the hypoperfused tissue. This study allowed them to understand that shallow networks are prone to overestimate the lesion volumes and that the usage of \acrshort{tmax} is not sufficient to predict accurately, with \acrshort{cnn}\textsubscript{deep} achieving the best performance by taking into account the heterogeneity in stroke pathophysiology. 

\citet{pinto2018stroke} resorted to a different strategy where they combined the standard perfusion and diffusion data with the clinical meta-data \acrshort{tici}, in an U-Net architecture that included a \acrshort{2d} Gated Recurrent Unit (\acrshort{gru}) layer. Their approach combined the meta-data both at a population level, in order to encode the expected correlations between tissue loss and the \acrshort{tici} score into the loss function, and at a patient level, to explicitly encode the meta-data score of each subject as extra input channels. With this approach, they were able to achieve more accurate predictions, with competitive results, while resorting to a simpler architecture with fewer parameters. 

Another approach where the authors included clinical meta-data was proposed by Robben et al. \cite{winzeck2018isles}. In their work, they developed a voxel-wise classification resorting to relative \acrshort{ttp} (determined through \acrshort{ttp}), \acrshort{adc} and the \acrshort{tici} scores. The deep learning-based architecture, inspired by \citet{kamnitsas} proposal, employed a \acrshort{fcnn} with two pathways. One of them was implemented on the original resolution, and the other one on a resolution reduced by a factor of 3. Both pathways were fed into two fully connected layer, along with the meta-data, and then the final classification was performed.

Monteiro et al. \cite{winzeck2018isles} proposed a \acrshort{fcnn} with a V-Net architecture similar to the architecture proposed in \citet{loss}. With contracting and expanding paths, similar to the U-Net, it halved the spatial dimensions of the images and doubled the number of channels at each level of the contracting path, and performed the opposite on the latter one. Besides the long skip connections between the contracting and expanding paths, they included skip connections in each convolutional block similar to a ResNet \cite{he2016deep}. Furthermore, to address the class imbalance, they developed a loss function comprising the sum of a cross-entropy loss and the Dice loss.

Lucas et al. \cite{winzeck2018isles} developed a strategy where they employed an U-Net to segment transversal stroke image slices. Besides the \acrshort{mri} sequences, they resorted to three slices including both direct neighboring slices and two hemispheric flips as input. In the encoder, small details were enhanced as the patch size reduced from $ 240\times240 $ to $ 15\times15 $ and additional residual connections were employed, connecting the input of each level to its output. Moreover, they included a Dice loss at the end of each level of the decoder path after a softmax layer, which then summed up to a total training loss. To mitigate the class imbalance problem, they weighted the loss of foreground and background with its inverse prior probability.

Besides the standard parametric maps, the \acrshort{isles} 2017 competition also provided \acrshort{4d} \acrshort{pwi} data. \citet{pinto} proposed an enhanced strategy, which considered both data. The inclusion of the data-driven \acrshort{pwi} provided information on the brain blood flow hemodynamics, used to distinguish the penumbra from the ischemic core, which could not be obtained by using solely the standard perfusion and diffusion maps. In order to incorporate the \acrshort{4d} \acrshort{pwi} information, the authors detected the peak concentration of the contrasting agent applying k-means both on the mean signal intensity and standard deviation. This peak was then used to define a temporal window from which specific temporal acquisitions would be retrieved. These acquisitions hold a crucial role as they provide blood dynamics' details to estimate the tissue at risk. They processed the data-driven \acrshort{4d} \acrshort{pwi} and the standard parametric maps in two different U-Net models, and then merged the feature sets retrieved from each network. The concatenated features were then processed in a chain of convolutional layers to emphasize the most relevant features to the outcome prediction. With this strategy they were able to rank among the top five best approaches in the \acrshort{isles} 2017 Challenge competition.



\section{Summary}
Throughout the years, the ischemic stroke lesion segmentation and final infarct lesion prediction problems have been presented with increasing progress. However, none of the proposed prediction methods has been capable of achieving robust and reproducible results, especially due to reduced training data and complex cases with small volume lesions. From the many developed supervised methods, classification methods, such as Decision Trees, have been the most resorted proposals when performing segmentation tasks, and deep learning-based methods comprising \acrshort{cnn}s and ensemble strategies are mostly used in the prediction of the evolution of the lesion.

At an early phase of this research topic, classifiers such as Random Forests were the most used technique for stroke lesion segmentation. As the years passed, upgraded algorithms of this classifier, such as Extra Trees and Segmentation Forests, were implemented since they reduced the overfitting behaviors observed with Decision Trees. Moreover, cascaded classifiers proved their worth in the segmentation task, achieving reasonable performances on different sets of data. These methods, however, resorted mostly to spin echo \acrshort{mri} sequences, along with inversion recovery and \acrshort{dwi} data.

As of lately, researchers have been focusing their attention on developing deep learning-based approaches, while resorting to  the standard diffusion and perfusion \acrshort{mri} maps. Most recently, the inclusion of the data-driven \acrshort{4d} \acrshort{pwi} has been proposed, to complement the standard parametric maps with temporal data, which encodes the bolus passage. Most of the proposed methods either consisted of predictive classifiers, or \acrshort{fcnn}s structures, such as U-Nets. The latter architecture in an U shape has gained special attention in the medical image outcome prediction problem as it is capable of processing the data at the context and localization levels. Some strategies included variations of the U-Net, others added residual connections to generate complex features along the network, similar to the ResNet models. Among the many strategies, ensembles seem to be more capable of taking advantage of the most discriminative features retrieved from processing the input data in different networks, which allowed them to achieve some of the top performances.
	
	

	